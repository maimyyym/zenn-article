---
title: "ã€AWS SDK for JavaScript v3ã€‘DynamoDBæ“ä½œã®ã‚ã‚Œã“ã‚Œã‚’TypeScriptã§ç†è§£ã™ã‚‹"
emoji: "ğŸª¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["aws", "DynamoDB"]
publication_name: "fusic"
published: true
---
## ã“ã®è¨˜äº‹ã§è§£æ±ºã™ã‚‹ã“ã¨
SDK for JavaScript v3ã‚’ç”¨ã„ã¦DynamoDBã‚’æ“ä½œã™ã‚‹æ™‚ã«ä½¿ç”¨ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®é•ã„
- `@aws-sdk/client-dynamodb`ï¼š **DynamoDBClient**
- `@aws-sdk/lib-dynamodb`ï¼š **DynamoDBDocumentClient**

## ã‚„ã‚ŠãŸã„ã“ã¨
SDK for JavaScript v3ã‚’ç”¨ã„ã¦DynamoDBã«ãƒ‡ãƒ¼ã‚¿ã‚’æŒ¿å…¥ã™ã‚‹Lambdaé–¢æ•°ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã¾ã™ã€‚
### ç’°å¢ƒ
Lambda Node.js 20
APIGateway, DynamoDB
ï¼ˆAWS SAMã«ã‚ˆã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤ã€APIGatewayã‚³ãƒ³ã‚½ãƒ¼ãƒ«ä¸Šã‹ã‚‰ãƒ†ã‚¹ãƒˆï¼‰

## AWS SDK for JavaScript v3ã§ã®DynamoDBæ“ä½œã«ã¤ã„ã¦
AWS SDK for JavaScript v3ã§ã¯ã€æ“ä½œã—ãŸã„å„ãƒªã‚½ãƒ¼ã‚¹ã”ã¨ã«ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ä½¿ç”¨ã—ã¾ã™ã€‚DynamoDBæ“ä½œã®å ´åˆã€`@aws-sdk/client-dynamodb`ã‚‚ã—ãã¯`@aws-sdk/lib-dynamodb`ã®ã©ã¡ã‚‰ã‹ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
```
npm install @aws-sdk/client-dynamodb
```
ã¾ãŸã¯
```
npm install @aws-sdk/lib-dynamodb
```

### ã“ã“ã§è¬
é¸æŠè‚¢ãŒäºŒã¤ã€‚ã©ã£ã¡ã§ã‚‚è‰¯ã•ãã†ã«è¦‹ãˆã‚‹ã€‚
ã©ã†é•ã†ã®ï¼Ÿã©ã£ã¡ã‚’ä½¿ãˆã°ã„ã„ã®ï¼Ÿï¼Ÿ

## ã©ã†é•ã†ã®ï¼Ÿï¼ˆã–ã£ãã‚Šï¼‰
### `@aws-sdk/client-dynamodb`
SDKã«ãŠã„ã¦ã€æ“ä½œå¯èƒ½ãªå„ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åç§°ã¯`@aws-sdk/client-xxxxx`ã§å§‹ã¾ã£ã¦ã„ã¾ã™ã€‚
https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/client/dynamodb/

### `@aws-sdk/lib-dynamodb`
ä¸€æ–¹ã§ã€`@aws-sdk/lib-xxxxx`ã¨ã„ã†åç§°ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰ãŒã‚ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã¯DynamoDBã¨S3ã®ã¿ã§ã™ã€‚ï¼ˆ2024/04/15æ™‚ç‚¹ï¼‰
ä¾‹ãˆã°`@aws-sdk/lib-dynamodb`ã«ã¤ã„ã¦ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ä»¥ä¸‹ã®ã‚ˆã†ãªè¨˜è¼‰ãŒã‚ã‚Šã¾ã™ã€‚
https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/Package/-aws-sdk-lib-dynamodb/
> The document client simplifies working with items in Amazon DynamoDB by abstracting away the notion of attribute values. This abstraction annotates native JavaScript types supplied as input parameters, as well as converts annotated response data to native JavaScript types.

`@aws-sdk/client-dynamodb`ã¨ç•°ãªã‚Š`@aws-sdk/lib-dynamodb`ã¯DynamoDBã®å±æ€§å€¤ã®æ¦‚å¿µã‚’æŠ½è±¡åŒ–ã™ã‚‹ã“ã¨ã§æ“ä½œã‚’ç°¡ç´ åŒ–ã—ãŸã‚‚ã®ã ãã†ã§ã™ã€‚
DynamoDBãŒè¿”ã™ã‚¢ã‚¤ãƒ†ãƒ ã®ãƒ‡ãƒ¼ã‚¿å‹ã¯`AttributeValue`ã§ã™ãŒã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ã‚ˆã‚Š **JavaScriptã®å‹ã‚’ä½¿ç”¨ã—ã¦**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’æ‰±ã†ã“ã¨ãŒã§ãã¾ã™ã€‚
ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯DynamoDBClientã‚’ãƒ©ãƒƒãƒ—ã—ãŸã‚‚ã®ã¨è¨€ãˆã‚‹ã§ã—ã‚‡ã†ã€‚
åˆ†ã‹ã‚Šã¥ã‚‰ã„ã®ã§ã€å…·ä½“çš„ãªã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

## ã‚³ãƒ¼ãƒ‰ã®é•ã„ã‚’è¦‹ã‚‹
### ã‚„ã‚‹ã“ã¨
APIGatewayã¨Lambdaã§APIã‚’å®Ÿè£…ã—ã€`id`ã‚’PKã¨ã™ã‚‹ã‚·ãƒ³ãƒ—ãƒ«ãªDynamoDBãƒ†ãƒ¼ãƒ–ãƒ«ã«ä»¥ä¸‹ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’putã—ã¾ã™ã€‚
| id | name | age |
| -- | ---- | --- |
|  1 | John |  20 |

ãƒ†ãƒ¼ãƒ–ãƒ«ã¨APIã¯ä½œæˆæ¸ˆã¿ã§ã‚ã‚‹ã“ã¨ã‚’å‰æã¨ã—ã€ä»¥é™ã¯Lambdaé–¢æ•°ã®ã‚³ãƒ¼ãƒ‰ã«ã¤ã„ã¦ã®ã¿èª¬æ˜ã—ã¾ã™ã€‚
### `@aws-sdk/client-dynamodb`ã®å ´åˆ
```ts
import { DynamoDBClient, PutItemCommandInput, PutItemCommand } from '@aws-sdk/client-dynamodb';
import { APIGatewayProxyEvent, APIGatewayProxyResult } from 'aws-lambda';

const dynamodbClient = new DynamoDBClient({
    region: 'ap-northeast-1',
});

export const lambdaHandler = async (event: APIGatewayProxyEvent): Promise<APIGatewayProxyResult> => {
    const params: PutItemCommandInput = {
        TableName: 'test-table',
        Item: {
            id: { S: '1' },
            name: { S: 'John' },
            age: { N: '20' },
        },
    };
    const command = new PutItemCommand(params);
    try {
        await dynamodbClient.send(command);
        return {
            statusCode: 200,
            body: 'success',
        };
    } catch (err) {
        return {
            statusCode: 500,
            body: JSON.stringify({
                message: 'some error happened',
            }),
        };
    }
};
```

### `@aws-sdk/lib-dynamodb`ã®å ´åˆ
```ts
import { DynamoDBClient } from '@aws-sdk/client-dynamodb';
import { DynamoDBDocumentClient, PutCommand, PutCommandInput } from '@aws-sdk/lib-dynamodb';
import { APIGatewayProxyEvent, APIGatewayProxyResult } from 'aws-lambda';

const dynamodbClient = new DynamoDBClient({
    region: 'ap-northeast-1',
});

// ã“ã“ã§ã€â†‘ã§åˆæœŸåŒ–ã—ãŸDynamoDBClientã‚’ç”¨ã„ã¦DynamoDBDocumentClientã‚’åˆæœŸåŒ–
const docClient = DynamoDBDocumentClient.from(dynamodbClient);

export const lambdaHandler = async (event: APIGatewayProxyEvent): Promise<APIGatewayProxyResult> => {
    const params: PutCommandInput = {
        TableName: 'test-table',
        Item: {
            id: '1', // ã“ã“ãŒé•ã†ï¼
            name: 'John', // ã“ã“ãŒé•ã†ï¼
            age: 20, // ã“ã“ãŒé•ã†ï¼
        },
    };
    const command = new PutCommand(params);
    try {
        await docClient.send(command);
        return {
            statusCode: 200,
            body: 'success',
        };
    } catch (err) {
        return {
            statusCode: 500,
            body: JSON.stringify({
                message: 'some error happened',
            }),
        };
    }
};
```

### ä½•ãŒé•ã†ï¼Ÿ
- `@aws-sdk/lib-dynamodb`ã‚’ä½¿ã†ã¨`@aws-sdk/client-dynamodb`ã® **DynamoDBDocument**ã‚’ç”¨ã„ã¦åˆæœŸåŒ–ã—ãŸ **DynamoDBDocumentClient**ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã€ã¾ãšä¸€ã¤ç›®ã®é•ã„ã§ã™ã€‚

- ãã—ã¦å¤§ããç•°ãªã‚‹ã®ã¯ã€ä¸Šè¨˜ã‚³ãƒ¼ãƒ‰ã®`params`ã®æ›¸ãæ–¹ã§ã™ã€‚
`@aws-sdk/lib-dynamodb`ã® **DynamoDBDocumentClient**ã§ã¯ã€putã™ã‚‹`Item`ã‚’å˜ç´”ãªkeyã¨valueã§å®šç¾©ã—ã¦ã„ã¾ã™ã€‚
ã“ã‚Œã‚’`@aws-sdk/client-dynamodb`ã® **DynamoDBClient**ã§åŒã˜ã‚ˆã†ã«æ›¸ã„ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ï¼ˆ`id: { S: '1' }`ã‚’`id: '1'`ã¨ã™ã‚‹ï¼‰
:::details client-dynamodbã®ã¿ã§lib-dynamodbã®æ›¸ãæ–¹ã‚’ã™ã‚‹
```ts
import { DynamoDBClient, PutItemCommandInput, PutItemCommand } from '@aws-sdk/client-dynamodb';
import { APIGatewayProxyEvent, APIGatewayProxyResult } from 'aws-lambda';

const dynamodbClient = new DynamoDBClient({
    region: 'ap-northeast-1',
});

export const lambdaHandler = async (event: APIGatewayProxyEvent): Promise<APIGatewayProxyResult> => {
    const params: PutItemCommandInput = {
        TableName: 'test-table',
        Item: {
            id: '1', // { S: '1' }ã§ã¯ãªã'1'ã¨ã™ã‚‹
            name: 'John',
            age: '20',
        },
    };
    const command = new PutItemCommand(params);
    try {
        await dynamodbClient.send(command);
        return {
            statusCode: 200,
            body: 'success',
        };
    } catch (err) {
        return {
            statusCode: 500,
            body: JSON.stringify({
                message: 'some error happened',
            }),
        };
    }
};
```
:::
ã™ã‚‹ã¨`Item`å†…ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ä»¥ä¸‹ã®ã‚ˆã†ãªå‹ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚
```
Type 'string' is not assignable to type 'AttributeValue'. ts(2322)
```
`'1'`ã¨ã„ã†stringå‹ã®ã¾ã¾ã ã¨DynamoDBClientã®`PutItemCommandInput`ã«ãŠã„ã¦DynamoDBãƒ¬ã‚³ãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿å€¤ã®å‹ **AttributeValue**ã«ã¯é©ç”¨ã§ããªã„ã®ã§ã™ã€‚

### ã¤ã¾ã‚Š
`@aws-sdk/lib-dynamodb`ã® **DynamoDBDocumentClient**ã‚’ä½¿ã†ã¨ã€DynamoDBãƒ¬ã‚³ãƒ¼ãƒ‰ã®AttributeValueã«å¾“ã£ã¦å³å¯†ã«è¨˜è¿°ã›ãšã«JavaScriptã§å–ã‚Šæ‰±ã†ã“ã¨ã®ã§ãã‚‹stringã‚„numberãªã©ã®å‹ã§è¨˜è¿°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## ã©ã£ã¡ã‚’ä½¿ã†ï¼Ÿ
`@aws-sdk/lib-dynamodb`ã® **DynamoDBDocumentClient**ã¯JavaScriptã®å‹ã‚’ç”¨ã„ã¦ã‚·ãƒ³ãƒ—ãƒ«ã«è¨˜è¿°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ã‚³ãƒ¼ãƒ‰ã®è¨˜è¿°é‡ãŒæ¸›ã‚‹ã®ã§é–‹ç™ºã‚’é€²ã‚ã‚„ã™ããªã‚Šã¾ã™ã€‚å°è¦æ¨¡ã ã£ãŸã‚Šç°¡å˜ãªæ“ä½œã®ã¿ã§ã‚ã‚Œã° **DynamoDBDocumentClient**ã‚’ä½¿ã†ã¨ã‚ˆã•ãã†ã§ã™ã€‚
`@aws-sdk/client-dynamodb`ã® **DynamoDBClient**ã¯DynamoDBã®APIã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã§æ§˜ã€…ãªæ“ä½œãŒå¯èƒ½ã§ã™ã€‚å¤§é‡ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã£ãŸã‚Šã€è¤‡é›‘ãªæ“ä½œã‚’ã—ãŸã‚Šã™ã‚‹å ´åˆï¼ˆ`@aws-sdk/lib-dynamodb`ã§ã¯å¯¾å¿œã—ã¦ã„ãªã„æ“ä½œãŒã‚ã‚‹å ´åˆï¼‰ã¯ **DynamoDBClient** ã‚’ä½¿ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚
é–‹ç™ºè¦æ¨¡ã‚„çŠ¶æ³ã«å¿œã˜ã¦ã€æ–¹é‡ã‚’æ±ºã‚ã¦ä½¿ã„åˆ†ã‘ã‚‹ã¨ã‚ˆã„ã§ã—ã‚‡ã†ã€‚

## æ¬¡ã«èª¿ã¹ãŸã„ã“ã¨
ä»Šå›ã¯DynamoDBã®ãƒ‡ãƒ¼ã‚¿å‹ã‚„ãƒãƒ¼ã‚·ãƒ£ãƒªãƒ³ã‚°ã€ã‚¢ãƒ³ãƒãƒ¼ã‚·ãƒ£ãƒªãƒ³ã‚°ç­‰ã®æ·±æ˜ã‚Šã¯ã›ãšã«ç°¡å˜ãªå‡¦ç†ã®è¨˜è¿°æ–¹æ³•ã®é•ã„ã«ã¤ã„ã¦æ›¸ãã¾ã—ãŸã€‚
TypeScriptã‚’ç”¨ã„ã¦Lambdaé–¢æ•°ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã«ã‚ãŸã‚Šã€ãƒ‡ãƒ¼ã‚¿å‹ã«ã¤ã„ã¦ã‚‚ã•ã‚‰ã«èª¿ã¹ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã—ãŸã€‚

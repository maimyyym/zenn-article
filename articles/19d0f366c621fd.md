---
title: "いろんなポリシーの種類と条件を理解して構築するData perimeters on AWS"
emoji: "🏯"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["aws", "iam"]
published: false
publication_name: "fusic"
---
## この記事でできるようになること
S3等に保存しているデータに対して、
**「誰が」「どこから」アクセスできるかの制御** ＝ **データ境界** ＝ **Data perimeters**
を構築できるようになる。
よって、組織のデータを保護する。
※ここでいう「組織」とはAWS Organizationsで管理されている範囲を指す。

### ここで話すこと
データを保護するためにどのポリシータイプに何を書くか

### 話さないこと
各ポリシーそのものの深い説明や評価ロジックについて

## Data perimeters on AWSとは
[参考]
https://aws.amazon.com/identity/data-perimeters-on-aws/

組織のAWS環境内においてデータを保護するための境界として機能する許可ガードレールのセット。もっと噛み砕いて言うと、ポリシーのセットです。
アクセスできないものを制御するのではなく、 **信頼されたアイデンティティのみが、期待されたネットワークから、信頼されたリソースにアクセスする** ことを保証します。
既存のリソース単位ではなく、組織全体にSCP（Service Control Policy）・RCP（Resource Control Policy）・VPC endpoint policyを適用し、セキュリティの標準やベストプラクティスに準拠していることを保証します。

:::message
Data perimetersはAWSのサービス・機能・ソリューションというよりはアーキテクチャとしての概念・確立された考え方であると私は解釈しています。
ここでAWSが提供しているコード例等はあくまで一コンテンツであり、実際の運用においてはユーザーがセキュリティ保護等において責任を持って構築する必要があります。
:::

## AWS Organizationsのポリシー
### SCP（Service Control Policy）
IAMロールなど組織内のプリンシパルに付与される許可を**制限**するもの。
デフォルトでは全てのルートに`FullAWSAccess`がアタッチされています。
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "*",
      "Resource": "*"
    }
  ]
}
```

このように明示的なAllowが適用された上で、制限したい部分（OU・アカウント）にさらにSCPを適用することで組織内のあらゆるアクションを制限します。
[例]
東京リージョンかつ特定のロール以外のS3へのアクセスを全て禁止するSCPs
```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "DenyS3AccessOutsideSpecifiedRegion",
            "Effect": "Deny",
            "Action": [
                "s3:*"
            ],
            "Resource": "*",
            "Condition": {
                "StringNotEquals": {
                    "aws:RequestedRegion": [
                        "ap-northeast-1"
                    ]
                },
                "ArnNotLike": {
                    "aws:PrincipalARN": [
                        "arn:aws:iam::*:role/Role1AllowedToBypassThisSCP",
                        "arn:aws:iam::*:role/Role2AllowedToBypassThisSCP"
                    ]
                }
            }
        }
    ]
}
```

[その他の例]
https://docs.aws.amazon.com/ja_jp/organizations/latest/userguide/orgs_manage_policies_scps_examples.html



### RCP（Resource Control Policy）
組織内のリソースに対するアクセス許可を**制限**するもの。
2024年11月13日にリリースされました。
https://aws.amazon.com/jp/blogs/news/introducing-resource-control-policies-rcps-a-new-authorization-policy/


### SCPとRCPの違い

## VPC endpoint policy


## データ境界構築の考え方

### 概略
表

### リソースに対するアクセス制限：信頼されたアイデンティティのみ許可
### リソースに対するアクセス制限：信頼されたネットワークからのみ許可
### アイデンティティに対するアクセス制限：信頼されたリソースへのアクションのみ許可
### アイデンティティに対するアクセス制限：信頼されたネットワークのみ許可
### ネットワークに対するアクセス制限：信頼されたアイデンティティのみアクセスを許可
### ネットワークに対するアクセス制限：信頼されたリソースへのアクセスのみ許可